def generatedSourceDir = new File(buildDir, "generated/sources/spigradle/java/main")

sourceSets {
    main {
        groovy {
            srcDir generatedSourceDir
        }
    }
}

task generateSource {
    def source = new File(generatedSourceDir, "kr/entree/spigradle/SpigradleMeta.groovy")
    source.parentFile.mkdirs()
    source.newWriter().withCloseable {
        it.write("""\
                package kr.entree.spigradle
                class SpigradleMeta {
                    public static final String VERSION = "${project.version}"
                }
            """.stripIndent())
    }
}

compileGroovy.dependsOn generateSource