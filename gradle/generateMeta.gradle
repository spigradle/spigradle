def generatedSourceDir = new File(buildDir, "generated/sources/spigradle/java/main")

sourceSets {
    main {
        kotlin {
            srcDir generatedSourceDir
        }
    }
}

task generateSource {
    def source = new File(generatedSourceDir, "kr/entree/spigradle/SpigradleMeta.kt")
    source.parentFile.mkdirs()
    source.newWriter().withCloseable {
        it.write("""\
                package kr.entree.spigradle

                object SpigradleMeta {
                    const val VERSION = "${project.version}"
                }
            """.stripIndent())
    }
}

compileKotlin.dependsOn generateSource